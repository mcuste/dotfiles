# =============================================================================
# TMUX Configuration
# =============================================================================
# Main tmux configuration file for macOS dotfiles setup
# 
# Key Features:
# - Fish shell as default
# - Ctrl-A prefix key (instead of Ctrl-B)
# - Vim-style key bindings and navigation
# - Smart splits integration for seamless nvim/tmux navigation
# - Session persistence with tmux-resurrect/continuum
# - Catppuccin Mocha theme
#
# Installation:
# - Install plugins with: <prefix> + I (Ctrl-A + I)
# - Reload config with: <prefix> + r or tmux source-file ~/.config/tmux/tmux.conf
# =============================================================================

# =============================================================================
# BASIC SETTINGS
# =============================================================================

# Terminal and color settings
# set -g default-terminal "tmux-256color"  # Commented out to use terminal default
set -sa terminal-overrides ",xterm*:Tc"    # Enable true color support

# Indexing - start windows and panes at 1 instead of 0
set -g base-index 1                         # Start window numbering at 1
setw -g pane-base-index 1                   # Start pane numbering at 1

# Performance and behavior settings
set -g focus-events on                      # Enable focus events for vim/nvim
setw -g aggressive-resize on                # Aggressive resize for multiple clients
setw -g clock-mode-style 12                 # 12-hour clock format
set -g history-limit 500000                 # Increase scrollback buffer size
set -s escape-time 0                        # Remove delay when pressing escape

# Input and interaction settings
set -g status-keys vi                       # Use vi keys in status line
set -g mode-keys vi                         # Use vi keys in copy mode
set -g mouse on                             # Enable mouse support
set -g cursor-style block                   # Block cursor style

# Window naming
set -g automatic-rename on                  # Automatically rename windows
set -g automatic-rename-format '#{b:pane_current_path}'  # Use basename of current path

# Session management
set -g default-shell /opt/homebrew/bin/fish # Set Fish as default shell
new-session                                 # Create new session if none exists

# Status bar timing
set -g status-interval 5                    # Update status bar every 5 seconds

# =============================================================================
# KEY BINDINGS
# =============================================================================

# Prefix key configuration
unbind C-b                                  # Unbind default prefix
set -g prefix C-a                           # Set prefix to Ctrl-A
bind -N "Send the prefix key through to the application" M-a send-prefix

# Copy mode bindings (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection        # Start selection with 'v'
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle     # Rectangle selection with Ctrl-v
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel  # Copy with 'y'

# Window and pane management
bind-key -N "Kill the current window" & kill-window            # Kill window with &
bind-key -N "Kill the current pane" x kill-pane                # Kill pane with x
bind q kill-pane                                               # Alternative kill pane

# Pane splitting (maintain current directory)
bind -N "Split vertical" v split-window -h -c "#{pane_current_path}"    # Vertical split with v
bind -N "Split horizontal" s split-window -v -c "#{pane_current_path}"  # Horizontal split with s

# Window navigation  
bind -N "Move to previous window" h previous-window            # Previous window with h
bind -N "Move to next window" l next-window                    # Next window with l

# Session navigation
bind -N "Move to next session" j switch-client -n              # Next session with j
bind -N "Move to previous session" k switch-client -p          # Previous session with k

# Session management
bind S new-session                                             # Create new session with S

# Utility bindings
bind C-l send-keys 'C-l'                                       # Send Ctrl-L to clear screen

# =============================================================================
# PLUGIN CONFIGURATION
# =============================================================================

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'                              # Tmux Plugin Manager

# Core functionality plugins
set -g @plugin 'tmux-plugins/tmux-sensible'                    # Sensible default settings
set -g @plugin 'tmux-plugins/tmux-yank'                        # System clipboard integration

# Session persistence
set -g @plugin 'tmux-plugins/tmux-resurrect'                   # Save/restore tmux sessions
set -g @plugin 'tmux-plugins/tmux-continuum'                   # Automatic session save/restore
set -g @continuum-restore 'on'                                 # Auto-restore sessions on boot

# Smart splits plugin configuration for seamless nvim/tmux navigation
set -g @plugin 'mrjones2014/smart-splits.nvim'

set -g @smart-splits_resize_left_key  'M-H' # key-mapping for resizing.
set -g @smart-splits_resize_down_key  'M-J' #  --"--
set -g @smart-splits_resize_up_key    'M-K' #  --"--
set -g @smart-splits_resize_right_key 'M-L' #  --"--

# Try fix?
# Smart pane switching with awareness of Neovim splits.
bind-key -n C-h if -F "#{@pane-is-vim}" 'send-keys C-h'  'select-pane -L'
bind-key -n C-j if -F "#{@pane-is-vim}" 'send-keys C-j'  'select-pane -D'
bind-key -n C-k if -F "#{@pane-is-vim}" 'send-keys C-k'  'select-pane -U'
bind-key -n C-l if -F "#{@pane-is-vim}" 'send-keys C-l'  'select-pane -R'

# Theme configuration (Catppuccin Mocha)
set -g @plugin 'catppuccin/tmux#v2.1.3'                        # Catppuccin theme
set -g @catppuccin_flavor 'mocha'                               # Use mocha variant

# Status bar configuration
set -g status-right-length 100                                 # Right status bar max length
set -g status-left-length 100                                  # Left status bar max length  
set -g status-left ""                                          # Clear left status
set -g status-right "#{E:@catppuccin_status_application}"       # Show application
set -ag status-right "#{E:@catppuccin_status_session}"         # Show session info

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.config/tmux/plugins/tpm/tpm'
